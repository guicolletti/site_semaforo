<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Controle Semáforo</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <h1>Controle do Semáforo</h1>
  <button onclick="iniciar()">Iniciar</button>
  <button onclick="parar()">Parar</button>
  <p>Status: <span id="status">Desconhecido</span></p>

  <script>
    const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");

    client.on("connect", function () {
      console.log("Conectado ao broker MQTT");
      client.subscribe("semaforo/status");
    });

    client.on("message", function (topic, message) {
      if (topic === "semaforo/status") {
        const data = JSON.parse(message.toString());
        document.getElementById("status").textContent =
          data.active ? "Ligado - " + data.state : "Desligado";
      }
    });

    function iniciar() {
      client.publish("semaforo/cmd", "INICIAR");
    }

    function parar() {
      client.publish("semaforo/cmd", "PARAR");
    }
  </script>
</body>
</html>